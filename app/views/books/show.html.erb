<div class='container px-5 px-sm-0'>
   <div id="error_explanation">
        <% if @book.errors.any? %>
            <h3><%= @book.errors.count %>errors prohibited this obj from being saved:</h3>
            <ul><% @book.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
            </ul>
          <% end %>
        </div>
  <div class="row">



<%= render 'users/list', user:@book_user %>

<div class="col-md-8 offset-md-1">
      <h2>Book detail</h2>
      <table class="table table-hover table-inverse">
      <tbody>

      <tr>
        <td><%= link_to user_path(@book_user) do %>
        <%= attachment_image_tag @book_user, :profile_image, fallback: "no_image.jpg", size: "40x40"  %>
        </br>
        <%= @book_user.name %>
        <% end %>
        </td>

        <td><%= link_to @book.title, book_path(@book), class: 'book_id' %></td>
        <td><%= @book.body %></td>

        <!--非同期いいねボタンレンダー-->
        <td id="favorites_buttons_<%= @book.id %>">
           <%= render "favorites/favorite", book: @book %>
        </td>
        
        <td>コメント件数:<%= @book.book_comments.count %></td>

        <!--この本を登録したユーザーとログインしているユーザーが一緒なら、EditとDestroyを表示-->
        <% if @book_user.id == current_user.id %>
          <td><%= link_to "Edit", edit_book_path(@book), class: "btn btn-sm btn-success" %></td>
          <td><%= link_to "Destroy", book_path(@book), method: :delete, data: {confirm: "本当に消しますか？"}, class: "btn btn-sm btn-danger" %></td>
        <% end %>
      </tr>
  </tbody>
</table>

      <!--コメント機能追加-->
        <!--コメント一覧-->
        <div>
          <div>
        <% @book.book_comments.each do |book_comment| %>

          <div>
            <%= link_to user_path(book_comment.user) do %>
            <%= attachment_image_tag book_comment.user, :profile_image, fallback: "no_image.jpg", size: "40x40" %>
            </dr><%= book_comment.user.name %>
            <% end %>
            <%= book_comment.comment %>

            <% if book_comment.user == current_user %>
              <%= link_to 'Destroy', book_book_comment_path(book_comment.book, book_comment), method: :delete, class:"btn btn-sm btn-danger" %>
            <% end %>
          </div>

        <% end %>
        </div>



        <div>
          <!--コメント投稿欄-->
          <%= form_with(model:[@book, @book_comment], local:true) do |f| %>



          <div class="form-group">
              <label for="book_comment"></label>
              <%= f.text_area :comment, class: "form-control", rows: "5", placeholder: "コメントここに"  %>
          </div>
          <div class="form-group">
            <%= f.submit '送信'%>
          </div>
          <% end %>

          </div>
      </div>

    </div>


</div>
</div>